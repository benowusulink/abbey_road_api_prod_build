function e(e,t,s,a){Object.defineProperty(e,t,{get:s,set:a,enumerable:!0,configurable:!0})}var t=globalThis.parcelRequire8ea6,s=t.register;s("EbTHI",function(s,a){e(s.exports,"Admin_estates_controller",()=>d);var _=t("lU9Gz"),i=t("9OR5R");class d{constructor(){this.model=new(0,_.Admin_estates_model),this.view=new(0,i.Admin_estates_view),this.view.articles_event_listener(e=>{1===e?(this.model.fetch_estates(),this.model.registerListener(e=>{this.view.render_estates(e),this.view.get_selected_estate(this.get_selected_estate),this.view.edit_selected_estate(this.edit_selected_estate)})):2===e?(this.model.registerListener(e=>{this.view.render_add_estate(e)}),this.view.add_estate(this.add_estate)):3===e&&(this.model.registerListener(e=>{this.view.render_delete_estate(e)}),this.model.fetch_estates(),this.view.delete_estate(this.delete_estate))})}get_selected_estate=e=>{this.model.get_selected_estate(e)};edit_selected_estate=e=>{this.model.edit_selected_estate(e)};add_estate=e=>{this.model.add_new_estate(e)};delete_estate=e=>{this.model.delete_estate(e)}}}),s("lU9Gz",function(t,s){e(t.exports,"Admin_estates_model",()=>a);class a{constructor(){this.state={loading:!1,estates:{view:{estates_array:null,selected_estate:null},edit:{added_new_estate:!1,attempted_added_new_estate:!1},add:{added_new_estate:!1,attempted_added_new_estate:!1},delete:{deleted_estate:!1,attempted_deleted_estate:!1}}},this.listeners=[]}setState=e=>{let t=(e,s)=>{for(let a in s)"object"!=typeof e[a]||"object"!=typeof s[a]||null===e[a]||null===s[a]||Array.isArray(e[a])||Array.isArray(s[a])?e[a]=s[a]:t(e[a],s[a]);return e};return this.state=t({...this.state},e),this.notifyListeners(),console.log(this.state),this.state};registerListener=e=>{this.listeners.push(e),e(this.state)};notifyListeners=()=>{this.listeners.forEach(e=>{e(this.state)})};fetch_estates=()=>{this.setState({loading:!0}),fetch("https://www.abbeyroad.org.uk/api/admin_estates_page/fetch_estates").then(e=>e.json()).then(e=>{if(e.success){let t=e.estates_array,s={};t.estate_page_elements.forEach(e=>{"estates-main-article1-p1"===e.estate_id&&(e.estate_id,e.estate_main_text),e.estate_title&&(s[e.estate_title]||(s[e.estate_title]=[]),s[e.estate_title].push(e))});let a=Object.entries(s).map(([e,t])=>({estate_title:e,elements:t})),_={};t.estate_page_images.forEach(e=>{let t=e.estate_category;t&&(_[t]||(_[t]=[]),_[t].push(e))}),a=a.map(e=>{let t=_[e.estate_title]||[];return{...e,images:t}}),this.setState({loading:!1,estates:{view:{estates_array:a}}})}else this.setState({loading:!1,estates:{view:{estates_array:null}}})}).catch(e=>{console.log(e),this.setState({loading:!1,estates:{view:{estates_array:null}}})})};get_selected_estate=e=>{if(this.state.estates.view.estates_array){this.setState({loading:!0});let t=this.state.estates.view.estates_array.filter(t=>{if(t.estate_title===e)return t});this.setState({loading:!1,estates:{view:{selected_estate:t[0]}}}),this.fetch_estates()}};edit_selected_estate=e=>{this.setState({loading:!0});let t=new FormData;e.image_name&&(console.log(e.image_name),t.append("edited_image",e.image),t.append("image_name",JSON.stringify(e.image_name)));let s={};e.main_text&&(s.main_text=e.main_text),e.estate_text&&(s.estate_text=e.estate_text),e.estate_address&&(s.estate_address=e.estate_address),e.estate_google_street&&(s.estate_google_street_url=e.estate_google_street),e.estate_google_maps&&(s.estate_google_maps_url=e.estate_google_maps),e.category&&t.append("category",JSON.stringify({estate_title:e.category})),t.append("updated_estate",JSON.stringify(s)),fetch("http://localhost:3001/api/admin_estate_page/edit_selected_estate",{method:"put",body:t}).then(e=>e.json()).then(e=>{e.success?(console.log(),this.setState({loading:!1,estates:{view:{selected_estate:{estate_title:e.updated_estate[0].estate_title,elements:e.updated_estate}},edit:{added_new_estate:!0,attempted_added_new_estate:!1}}}),this.fetch_estates()):this.setState({loading:!1,estates:{edit:{added_new_estate:!1,attempted_added_new_estate:!0}}})}).catch(e=>{console.log(e),this.setState({loading:!1,estates:{edit:{attempted_added_new_estate:!0}}})})};add_new_estate=e=>{{this.setState({loading:!0});let t=new FormData;t.append("add_estate",JSON.stringify(e.add_estate)),e.images.forEach(e=>{t.append("added_estate_images",e)}),fetch("https://www.abbeyroad.org.uk/api/admin_estate_page/add_new_estate",{method:"post",body:t}).then(e=>e.json()).then(e=>{e.success?this.setState({loading:!1,estates:{add:{added_new_estate:!0,attempted_added_new_estate:!1}}}):this.setState({loading:!1,estates:{add:{added_new_estate:!1,attempted_added_new_estate:!0}}})}).catch(e=>{this.setState({loading:!1,estates:{add:{added_new_estate:!1,attempted_added_new_estate:!0}}})})}};delete_estate=e=>{this.setState({loading:!0}),e.length>0?fetch("https://www.abbeyroad.org.uk/api/admin_estate_page/delete_estate",{method:"delete",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e})}).then(e=>e.json()).then(e=>{e.success?(this.setState({loading:!1,estates:{delete:{deleted_estate:!0,attempted_deleted_estate:!1}}}),this.fetch_estates()):this.setState({loading:!1,estates:{delete:{deleted_estate:!1,attempted_deleted_estate:!0}}})}).catch(e=>{console.log(e),this.setState({loading:!1,estates:{delete:{deleted_estate:!1,attempted_deleted_estate:!0}}})}):this.setState({loading:!1,estates:{delete:{deleted_estate:!1,attempted_deleted_estate:!0}}})}}}),s("9OR5R",function(t,s){e(t.exports,"Admin_estates_view",()=>a);class a{constructor(){this.clicked_btn=!1,this.get_selected_estate_function=null,this.selected_img=null,this.edit_selected_estatefunction=null,this.selected_delete_ul=null}articles_event_listener=e=>{let t=Array.from(document.getElementsByClassName("admin_estates_page_main_section_article_div_span")),s=null;t.forEach((t,a)=>{t.addEventListener("click",()=>{s=`admin_estates_page_main_section_article_div_span${a+1}`;let _=document.getElementById(`admin_estates_page_main_section_section1_article_div${a+1}`);this.clicked_btn?(this.clicked_btn=!1,_.style.display="none",t.textContent="Click Here",t.style.fontSize="110%",t.style.color="var(--fourth-color)",t.style.backgroundColor="var(--third-color)",t.style.border="var(--fourth-color) solid 2px"):(this.clicked_btn=!0,_.style.display="flex",t.textContent="X",t.style.fontSize="200%",t.style.color="darkred",t.style.border="red solid 2px",e(a+1)),Array.from(document.getElementsByClassName("admin_estates_page_main_section_article_div1")).forEach((e,t)=>{e.id!==_.id&&(e.style.display="none")}),Array.from(document.getElementsByClassName("admin_estates_page_main_section_article_div_span")).forEach(e=>{s!==e.id&&(e.textContent="Click Here",e.style.fontSize="110%",e.style.color="var(--fourth-color)",e.style.backgroundColor="var(--third-color)",e.style.border="var(--fourth-color) solid 2px")})})})};render_estates=e=>{let t=document.getElementById("admin_estates_page_main_section_section1_article_div1_loading"),s=document.getElementById("admin_estates_page_main_section_section1_article_div1_h3"),a=document.getElementById("admin_estates_page_main_section_section1_article_div1_ul2"),_=document.getElementById("admin_estates_page_main_section_section1_article_div2_loading"),i=document.getElementById("admin_estates_page_main_section_section1_article1_div3"),d=document.getElementById("admin_estates_page_main_section_section1_article1_div3_ul1_li1_p2"),l=document.getElementById("admin_estates_page_main_section_section1_article1_div3_ul1_li1_p1"),n=document.getElementById("admin_estates_page_main_section_section1_article1_div3_div1_p1"),o=document.getElementById("admin_estates_page_main_section_section1_article1_div3_ul2_li1_p2"),c=document.getElementById("admin_estates_page_main_section_section1_article1_div3_ul2_li1_p1"),r=document.getElementById("admin_estates_page_main_section_section1_article1_div3_ul3"),m=document.getElementById("edit_estates_form"),g=document.getElementById("edit_estates_form_div_loading"),p=document.getElementById("edit_estates_form_err_msg"),y=document.getElementById("edit_estates_form_success_msg"),u=()=>{t.style.display="none",s.style.display="none",_.style.display="none",i.style.display="none",m.style.display="none",g.style.display="none",p.style.display="none",y.style.display="none",d.textContent="",l.textContent="",n.textContent="",o.textContent="",c.textContent=""};e.loading&&(u(),t.style.display="block",_.style.display="block",g.style.display="block"),e.estates.view.estates_array&&(u(),a.replaceChildren(),r.replaceChildren(),e.estates.view.estates_array.forEach(e=>{let t=document.createElement("li");t.classList.add("admin_estates_page_main_section_section1_article_div1_ul2_li"),t.setAttribute("name",e.estate_title),t.textContent=e.estate_title,a.appendChild(t),t.addEventListener("click",e=>{this.get_selected_estate_function(e.currentTarget.getAttribute("name")),Array.from(document.getElementsByClassName("admin_estates_page_main_section_section1_article_div1_ul2_li")).forEach(e=>{e.classList.remove("admin_estates_page_main_section_section1_article_div1_ul2_li_selected")}),e.currentTarget.classList.add("admin_estates_page_main_section_section1_article_div1_ul2_li_selected")})})),e.estates.view.estates_array||(u(),a.replaceChildren(),r.replaceChildren(),s.style.display="block"),e.estates.view.selected_estate&&e.estates.view.estates_array&&(u(),r.replaceChildren(),i.style.display="flex",m.style.display="flex",console.log(e.estates.view.selected_estate.elements[0]),d.textContent=e.estates.view.selected_estate.elements[0].estate_title,l.textContent=e.estates.view.selected_estate.elements[0].estate_address,n.textContent=e.estates.view.selected_estate.elements[0].estate_text,o.textContent=e.estates.view.selected_estate.elements[0].estate_google_street_url,c.textContent=e.estates.view.selected_estate.elements[0].estate_google_maps_url,e.estates.view.selected_estate.images.forEach(e=>{let t=document.createElement("li"),s=document.createElement("img");t.classList.add("admin_estates_page_main_section_section1_article1_div3_ul3_li"),s.classList.add("admin_estates_page_main_section_section1_article1_div3_ul3_li_img"),s.setAttribute("name",e.estate_image_id),s.setAttribute("src",e.estate_image_production_url),s.addEventListener("click",e=>{this.selected_img=e.currentTarget.getAttribute("name"),Array.from(document.getElementsByClassName("admin_estates_page_main_section_section1_article1_div3_ul3_li_img")).forEach(e=>{e.classList.remove("admin_estates_page_main_section_section1_article1_div3_ul3_li_img_selected")}),e.currentTarget.classList.add("admin_estates_page_main_section_section1_article1_div3_ul3_li_img_selected")}),t.appendChild(s),r.appendChild(t)}),m.onsubmit=t=>{t.preventDefault(),console.log("form clicked");let s=document.getElementById("edit_estates_form_address").value,a=document.getElementById("edit_estates_form_google_maps").value,_=document.getElementById("edit_estates_form_google_street").value,i=document.getElementById("edit_estates_form_text").value,d=document.getElementById("edit_estates_form_images").files[0],l={};this.selected_img&&(l.image=d,l.image_name=this.selected_img),s.length>0&&(l.estate_address=s),a.length>0&&(l.estate_google_maps=a),_.length>0&&(l.estate_google_street=_),i.length>0&&(l.estate_text=i),l.category=e.estates.view.selected_estate.estate_title,this.edit_selected_estatefunction(l)}),e.estates.edit.added_new_estate&&(u(),r.replaceChildren(),i.style.display="flex",m.style.display="flex",d.textContent=e.estates.view.selected_estate.elements[0].estate_title,l.textContent=e.estates.view.selected_estate.elements[0].estate_address,n.textContent=e.estates.view.selected_estate.elements[0].estate_text,o.textContent=e.estates.view.selected_estate.elements[0].estate_google_street_url,c.textContent=e.estates.view.selected_estate.elements[0].estate_google_maps_url,console.log(e.estates.view.selected_estate.images),e.estates.view.selected_estate.images.forEach(e=>{let t=document.createElement("li"),s=document.createElement("img");t.classList.add("admin_estates_page_main_section_section1_article1_div3_ul3_li"),s.classList.add("admin_estates_page_main_section_section1_article1_div3_ul3_li_img"),s.setAttribute("name",e.estate_image_id),s.setAttribute("src",e.estate_image_production_url),s.addEventListener("click",e=>{this.selected_img=e.currentTarget.getAttribute("name"),Array.from(document.getElementsByClassName("admin_estates_page_main_section_section1_article1_div3_ul3_li_img")).forEach(e=>{e.classList.remove("admin_estates_page_main_section_section1_article1_div3_ul3_li_img_selected")}),e.currentTarget.classList.add("admin_estates_page_main_section_section1_article1_div3_ul3_li_img_selected")}),t.appendChild(s),r.appendChild(t)}),m.onsubmit=t=>{t.preventDefault(),console.log("form clicked");let s=document.getElementById("edit_estates_form_address").value,a=document.getElementById("edit_estates_form_google_maps").value,_=document.getElementById("edit_estates_form_google_street").value,i=document.getElementById("edit_estates_form_text").value,d=document.getElementById("edit_estates_form_images").files[0],l={};this.selected_img&&(l.image=d,l.image_name=this.selected_img),s.length>0&&(l.estate_address=s),a.length>0&&(l.estate_google_maps=a),_.length>0&&(l.estates_google_street=_),i.length>0&&(l.estates_text=i),l.category=e.estates.view.selected_estate.estate_title,this.edit_selected_estatefunction(l)},m.reset(),y.style.display="flex",p.style.display="none"),e.estates.edit.attempted_added_new_estate&&(y.style.display="none",p.style.display="flex")};get_selected_estate=e=>{this.get_selected_estate_function=e};edit_selected_estate=e=>{this.edit_selected_estatefunction=e};render_add_estate=e=>{let t=document.getElementById("add_estates_form_div_loading"),s=document.getElementById("add_estates_form_err_msg"),a=document.getElementById("add_estates_form_success_msg");e.loading?(s.style.display="none",a.style.display="none",t.style.display="block"):e.estates.add.added_new_estate?(s.style.display="none",t.style.display="none",a.style.display="block",document.getElementById("add_estates_form").reset()):e.estates.add.attempted_added_new_estate?(a.style.display="none",t.style.display="none",s.style.display="block"):(a.style.display="none",t.style.display="none",s.style.display="none")};add_estate=e=>{document.getElementById("add_estates_form").onsubmit=t=>{t.preventDefault();let s=document.getElementById("add_estates_form_title").value,a=document.getElementById("add_estates_form_address").value,_=document.getElementById("add_estates_form_google_maps").value,i=document.getElementById("add_estates_form_google_street").value,d=document.getElementById("add_estates_form_text").value,l=Array.from(document.getElementById("add_estates_form_images").files),n={};n.images=l,n.add_estate={},n.add_estate.estate_title=s,n.add_estate.estate_address=a,_.length>0&&(n.add_estate.estate_google_maps_url=_),i.length>0&&(n.add_estate.estate_google_street_url=i),n.add_estate.estate_text=d,n.add_estate.estate_id=s,e(n)}};render_delete_estate=e=>{let t=document.getElementById("admin_estates_page_main_section_section1_article_div3_loading"),s=document.getElementById("admin_estates_page_main_section_section1_article_div3_ul1"),a=document.getElementById("admin_estates_page_main_section_section1_article_div3_div3_loading"),_=document.getElementById("admin_estates_page_main_section_section1_article_div3_div3_success"),i=document.getElementById("admin_estates_page_main_section_section1_article_div3_div3_err");e.loading?(i.style.display="none",_.style.display="none",t.style.display="block",a.style.display="block"):e.estates.delete.deleted_estate?(i.style.display="none",t.style.display="none",a.style.display="none",_.style.display="block",s.replaceChildren(),e.estates.view.estates_array.forEach(e=>{let t=document.createElement("li");t.classList.add("admin_estates_page_main_section_section1_article_div3_ul1_li"),t.setAttribute("name",e.estate_title),t.textContent=e.estate_title,s.appendChild(t),t.addEventListener("click",e=>{this.selected_delete_ul=e.currentTarget.getAttribute("name"),Array.from(document.getElementsByClassName("admin_estates_page_main_section_section1_article_div3_ul1_li")).forEach(e=>{e.classList.remove("admin_estates_page_main_section_section1_article_div3_ul1_li_selected")}),e.currentTarget.classList.add("admin_estates_page_main_section_section1_article_div3_ul1_li_selected")})})):e.estates.delete.attempted_deleted_estate?(_.style.display="none",t.style.display="none",a.style.display="none",i.style.display="block",s.replaceChildren(),e.estates.view.estates_array.forEach(e=>{let t=document.createElement("li");t.classList.add("admin_estates_page_main_section_section1_article_div3_ul1_li"),t.setAttribute("name",e.estate_title),t.textContent=e.estate_title,s.appendChild(t),t.addEventListener("click",e=>{this.selected_delete_ul=e.currentTarget.getAttribute("name"),Array.from(document.getElementsByClassName("admin_estates_page_main_section_section1_article_div3_ul1_li")).forEach(e=>{e.classList.remove("admin_estates_page_main_section_section1_article_div3_ul1_li_selected")}),e.currentTarget.classList.add("admin_estates_page_main_section_section1_article_div3_ul1_li_selected")})})):e.estates.view.estates_array&&(_.style.display="none",t.style.display="none",a.style.display="none",i.style.display="none",s.replaceChildren(),e.estates.view.estates_array.forEach(e=>{let t=document.createElement("li");t.classList.add("admin_estates_page_main_section_section1_article_div3_ul1_li"),t.setAttribute("name",e.estate_title),t.textContent=e.estate_title,s.appendChild(t),t.addEventListener("click",e=>{this.selected_delete_ul=e.currentTarget.getAttribute("name"),Array.from(document.getElementsByClassName("admin_estates_page_main_section_section1_article_div3_ul1_li")).forEach(e=>{e.classList.remove("admin_estates_page_main_section_section1_article_div3_ul1_li_selected")}),e.currentTarget.classList.add("admin_estates_page_main_section_section1_article_div3_ul1_li_selected")})}))};delete_estate=e=>{document.getElementById("admin_estates_page_main_section_section1_article_div3_div2_btn").addEventListener("click",t=>{e(this.selected_delete_ul)})}}});
//# sourceMappingURL=controller.57367791.js.map
