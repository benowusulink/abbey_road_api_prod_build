function e(e,t,s,a){Object.defineProperty(e,t,{get:s,set:a,enumerable:!0,configurable:!0})}var t=globalThis.parcelRequire8ea6,s=t.register;s("kShGt",function(s,a){e(s.exports,"Estates_controller",()=>l);var i=t("1igQN"),n=t("edyy0");class l{constructor(){this.model=new(0,i.Estates_model),this.view=new(0,n.Estates_view),this.model.registerListener(e=>{this.view.render_page_elements(e)}),this.model.fetch_estate_elements(),this.view.open_and_close_navbar()}}}),s("1igQN",function(t,s){e(t.exports,"Estates_model",()=>a);class a{constructor(){this.state={loading:!0,estate_elements:[],estate_elements_empty:null,estate_main_text:{id:null,text:""}},this.listeners=[]}setState=e=>(this.state={...this.state,...e},this.notifyListeners(),console.log(this.state),this.state);registerListener=e=>{this.listeners=[...this.listeners,e],e(this.state)};notifyListeners=()=>{this.listeners.forEach(e=>{e(this.state)})};fetch_estate_elements=()=>{fetch("https://www.abbeyroad.org.uk/api/estates-page/fetch_page_elements").then(e=>e.json()).then(e=>{if(e.success&&e.estate_page&&"object"==typeof e.estate_page&&Array.isArray(e.estate_page.estate_page_images)&&Array.isArray(e.estate_page.estate_page_elements)){let t=e.estate_page,s={},a=null;t.estate_page_elements.forEach(e=>{"estates-main-article1-p1"===e.estate_id&&(a={id:e.estate_id,estate_main_text:e.estate_main_text}),e.estate_title&&(s[e.estate_title]||(s[e.estate_title]=[]),s[e.estate_title].push(e))});let i=Object.entries(s).map(([e,t])=>({estate_title:e,elements:t})),n={};t.estate_page_images.forEach(e=>{let t=e.estate_category;t&&(n[t]||(n[t]=[]),n[t].push(e))}),i=i.map(e=>{let t=n[e.estate_title]||[];return{...e,images:t}}),console.log("succesfful fetch"),this.setState({loading:!1,estate_elements:i,estate_elements_empty:null,estate_main_text:{id:a.id,text:a.estate_main_text}})}else e.success&&null===e.estate_page?this.setState({loading:!1,estate_elements:[],estate_elements_empty:!0,estate_main_text:{id:null,text:""}}):this.setState({loading:!1,estate_elements:[],estate_elements_empty:null,estate_main_text:{id:null,text:""}})}).catch(e=>{console.log(e)})}}}),s("edyy0",function(t,s){e(t.exports,"Estates_view",()=>a);class a{constructor(){this.initial_elements_render=!1,this.estate_element_images=[],this.estate_element_images_mobile=[],this.current_image_index={},this.slideshowIntervals={}}open_and_close_navbar=()=>{let e=document.getElementById("mobile-menu-btn"),t=document.getElementById("mobile-menu-close"),s=document.getElementById("mobile-menu");e.addEventListener("click",e=>{s.style.display="block"}),t.addEventListener("click",e=>{s.style.display="none"})};render_page_elements=e=>{let t=document.getElementById("estates-main-section1"),s=document.getElementById("estates-main-article1"),a=document.getElementById("estates-mobile-card"),i=document.getElementById("estates-mobile-about-div1");if(e.loading){let e=document.createElement("div");e.setAttribute("id","estates-main-article1-p1-loading"),e.classList.add("loading"),s.appendChild(e);let n=document.createElement("div");n.setAttribute("id","estates-main-section1-loading"),n.classList.add("loading"),t.appendChild(n);let l=document.getElementById("estates-mobile-p");l&&i.removeChild(l);let d=document.createElement("div");d.setAttribute("id","estates_main_text_loading_mobile"),d.classList.add("loading"),i.appendChild(d),console.log(a),a.replaceChildren();let o=document.createElement("div");o.setAttribute("id","estates_main_section1_loading_mobile"),o.classList.add("loading"),a.appendChild(o)}else{let n=document.getElementById("estates-main-article1-p1-loading"),l=document.getElementById("estates-main-section1-loading");n.remove(),l.remove();let d=document.getElementById("estates_main_text_loading_mobile"),o=document.getElementById("estates_main_section1_loading_mobile");if(d.remove(),o.remove(),Array.isArray(e.estate_elements)&&e.estate_elements.length>0&&e.estate_elements.every(e=>"string"==typeof e.estate_title&&Array.isArray(e.elements)&&Array.isArray(e.images))&&e.estate_main_text&&"object"==typeof e.estate_main_text&&"string"==typeof e.estate_main_text.id&&"string"==typeof e.estate_main_text.text&&!1===this.initial_elements_render){let n=document.createElement("p");n.setAttribute("id",e.estate_main_text.id);let l=e.estate_main_text.text.split(/(?<=\.)\s+(?=[A-Z])/);n.textContent="",l.forEach((e,t)=>{let s=document.createTextNode(e);n.appendChild(s),t<l.length-1&&(n.appendChild(document.createElement("br")),n.appendChild(document.createElement("br")))}),s.appendChild(n);let d=document.createElement("p");d.setAttribute("id","estates-mobile-p"),d.textContent=e.estate_main_text.text,i.appendChild(d),e.estate_elements.forEach(e=>{let s=document.createElement("article"),a=document.createElement("div"),i=document.createElement("div"),n=document.createElement("h3"),l=document.createElement("p"),d=document.createElement("div"),o=document.createElement("div"),m=document.createElement("div"),r=document.createElement("div"),c=document.createElement("a"),_=document.createElement("a"),u=document.createElement("p"),p=document.createElement("p"),g=document.createElement("div"),h=document.createElement("div"),v=document.createElement("div"),b=document.createElement("div");s.setAttribute("id",e.estate_title),s.classList.add("estates-main-section1-article1"),a.classList.add("estates-main-section1-article1-div1"),i.classList.add("estates-main-section1-article1-div2"),n.setAttribute("id",`${e.elements[0].estate_id}_title`),n.classList.add("estates-main-section1-article1-div-h3"),l.setAttribute("id",`${e.elements[0].estate_id}_desc`),l.classList.add("estates-main-section1-article1-div-p"),d.classList.add("estates-main-section1-article1-div-div1"),o.classList.add("estates-main-section1-article1-div-div1"),m.classList.add("estates-main-section1-article1-div-div1"),r.classList.add("estates-main-section1-article1-div2-div2-div1"),c.setAttribute("id",`${e.elements[0].estate_id}_google_maps`),c.setAttribute("href",e.elements[0].estate_google_maps_url),c.setAttribute("target","_blank"),c.classList.add("estates-main-section1-article1-div2-div2-a"),_.setAttribute("id",`${e.elements[0].estate_id}_google_street`),_.setAttribute("href",e.elements[0].estate_google_street_url),_.setAttribute("target","_blank"),_.classList.add("estates-main-section1-article1-div2-div2-a"),u.classList.add("estates-main-section1-article1-div2-div2-span1-p"),p.classList.add("estates-main-section1-article1-div2-div2-span1-p2"),p.setAttribute("id",`${e.elements[0].estate_id}_address`),g.classList.add("estates-main-section1-article1-div2-div1"),g.setAttribute("id",`${e.estate_title}_img_div`),h.classList.add("estates-main-section1-article1-div2-div1-img-backward"),h.setAttribute("id",`${e.estate_title}_div_backward`),v.classList.add("estates-main-section1-article1-div2-div1-img-forward"),v.setAttribute("id",`${e.estate_title}_div_forward`),b.classList.add("estates-main-section1-article1-div2-div1-img-footer"),b.setAttribute("id",`${e.estate_title}_div_footer`),n.textContent=e.elements[0].estate_title;let E=e.elements[0].estate_text.split(/(?<=\.)\s+(?=[A-Z])/);l.textContent="",E.forEach((e,t)=>{let s=document.createTextNode(e);l.appendChild(s),t<E.length-1&&(l.appendChild(document.createElement("br")),l.appendChild(document.createElement("br")))}),c.textContent="Google Maps Location",_.textContent="Google Street Location",u.textContent="Address:",p.textContent=e.elements[0].estate_address,h.textContent="<",v.textContent=">",t.appendChild(s),s.append(a,i),a.append(n,l,d,o),i.appendChild(g),d.appendChild(m),o.appendChild(r),m.append(c,_),r.append(u,p),i.appendChild(g),g.append(h,v,b);let y={},f=1;e.images.forEach(t=>{let s=document.createElement("img");s.classList.add("estates-main-section1-article1-div2-div1-img"),s.setAttribute("id",`${e.estate_title}_img_${f}`),s.setAttribute("src",t.estate_image_production_url),y[t.estate_category]||(y[t.estate_category]=[]),y[t.estate_category].push(s),f+=1}),this.estate_element_images=[...this.estate_element_images,y]}),e.estate_elements.forEach(e=>{console.log(e);let t=document.createElement("div"),s=document.createElement("div"),i=document.createElement("div"),n=document.createElement("div"),l=document.createElement("div"),d=document.createElement("h3"),o=document.createElement("p"),m=document.createElement("p"),r=document.createElement("a"),c=document.createElement("a"),_=document.createElement("span");t.classList.add("estates-mobile-card-div"),d.classList.add("estates-mobile-h3"),s.classList.add("estates-mobile-image-wrapper"),i.classList.add("estates-mobile-content"),o.classList.add("estates-mobile-desc"),n.classList.add("estates-mobile-address"),l.classList.add("estates-mobile-links"),d.textContent=e.elements[0].estate_title,o.textContent=e.elements[0].estate_text,_.textContent="Address:",m.textContent=e.elements[0].estate_address,r.setAttribute("href",e.elements[0].estate_google_maps_url),r.textContent="Google Maps",c.setAttribute("href",e.elements[0].estate_google_street_url),c.textContent="Google Street",a.appendChild(t),t.append(d,s,i),i.append(o,n,l),n.append(_,m),l.append(r,c);let u={},p=1;e.images.forEach(e=>{let t=document.createElement("img");t.classList.add("estates-mobile-image"),t.setAttribute("src",e.estate_image_production_url),u[e.estate_category]||(u[e.estate_category]=[]),u[e.estate_category].push(t),p+=1}),this.estate_element_images_mobile=[...this.estate_element_images_mobile,u]}),this.initial_elements_render=!0,this.initDesktopSlideshow(),this.initMobileSlideshow()}else{let e=document.getElementById("estates-main-article1"),t=document.getElementById("estates-main-section1"),s=document.createElement("p"),a=document.createElement("p");s.setAttribute("id","estates-main-article1-p1"),s.textContent="Currently no information about our estates, Please visit Later",a.setAttribute("id","estates-main-section1-p1"),a.textContent="Currently no information about our estates, Please visit Later",e.appendChild(s),t.appendChild(a),p_mobile.setAttribute("id","estates-mobile-p"),p_mobile.textContent="Currently no information about our estates, Please visit Later",p2_mobile.setAttribute("id","#no_estates_p"),p2_mobile.textContent="Currently no information about our estates, Please visit Later",e.appendChild(p2_mobile),t.appendChild(p2_mobile)}}};initDesktopSlideshow=()=>{this.slideshowIntervals=this.slideshowIntervals||{},this.current_image_index=this.current_image_index||{};let e=Array.from(document.getElementsByClassName("estates-main-section1-article1")),t=(e,t)=>{let s=e.querySelector(".estates-main-section1-article1-div2-div1-img"),a=t.cloneNode(!0);a.classList.add("estates-main-section1-article1-div2-div1-img"),s?(s.classList.remove("show"),setTimeout(()=>{s.parentNode&&s.remove(),e.prepend(a),requestAnimationFrame(()=>a.classList.add("show"))},1e3)):(e.prepend(a),requestAnimationFrame(()=>a.classList.add("show")))};e.forEach(e=>{let s=document.getElementById(`${e.id}_img_div`);if(!s)return;let a=this.estate_element_images.find(t=>Object.keys(t)[0]===e.id);if(!a)return;let i=Object.values(a)[0];if(!i.length)return;let n=0;t(s,i[0]),this.slideshowIntervals[e.id]=setInterval(()=>{n=(n+1)%i.length,t(s,i[n]),this.current_image_index[e.id]=n},1e4);let l=document.getElementById(`${e.id}_div_backward`),d=document.getElementById(`${e.id}_div_forward`),o=a=>{clearInterval(this.slideshowIntervals[e.id]),n="back"===a?(n-1+i.length)%i.length:(n+1)%i.length,t(s,i[n]),this.current_image_index[e.id]=n};l&&l.addEventListener("click",()=>o("back")),d&&d.addEventListener("click",()=>o("forward"))})};initMobileSlideshow=()=>{Array.isArray(this.estate_element_images_mobile)&&(this.mobileIntervals=this.mobileIntervals||{},document.querySelectorAll(".estates-mobile-image-wrapper").forEach((e,t)=>{let s=this.estate_element_images_mobile[t];if(!s)return;let a=Object.values(s)[0];if(!a||0===a.length)return;e.replaceChildren(),a.forEach((t,s)=>{let a=t.cloneNode(!0);a.classList.add("estates-mobile-image"),0===s&&a.classList.add("show"),e.appendChild(a)});let i=0;this.mobileIntervals[t]=setInterval(()=>{let t=e.querySelectorAll(".estates-mobile-image");t[i].classList.remove("show"),i=(i+1)%t.length,t[i].classList.add("show")},1e4)}))}}});
//# sourceMappingURL=controller.67ef8a33.js.map
