function e(e,t,s,i){Object.defineProperty(e,t,{get:s,set:i,enumerable:!0,configurable:!0})}var t=globalThis.parcelRequire8ea6,s=t.register;s("kShGt",function(s,i){e(s.exports,"Estates_controller",()=>d);var a=t("1igQN"),n=t("edyy0");class d{constructor(){this.model=new(0,a.Estates_model),this.view=new(0,n.Estates_view),this.model.registerListener(e=>{this.view.render_page_elements(e)}),this.model.fetch_estate_elements()}}}),s("1igQN",function(t,s){e(t.exports,"Estates_model",()=>i);class i{constructor(){this.state={loading:!0,estate_elements:[],estate_elements_empty:null,estate_main_text:{id:null,text:""}},this.listeners=[]}setState=e=>(this.state={...this.state,...e},this.notifyListeners(),console.log(this.state),this.state);registerListener=e=>{this.listeners=[...this.listeners,e],e(this.state)};notifyListeners=()=>{this.listeners.forEach(e=>{e(this.state)})};fetch_estate_elements=()=>{fetch("https://www.abbeyroad.org.uk/api/estates-page/fetch_page_elements").then(e=>e.json()).then(e=>{if(e.success&&e.estate_page&&"object"==typeof e.estate_page&&Array.isArray(e.estate_page.estate_page_images)&&Array.isArray(e.estate_page.estate_page_elements)){let t=e.estate_page,s={},i=null;t.estate_page_elements.forEach(e=>{"estates-main-article1-p1"===e.estate_id&&(i={id:e.estate_id,estate_main_text:e.estate_main_text}),e.estate_title&&(s[e.estate_title]||(s[e.estate_title]=[]),s[e.estate_title].push(e))});let a=Object.entries(s).map(([e,t])=>({estate_title:e,elements:t})),n={};t.estate_page_images.forEach(e=>{let t=e.estate_category;t&&(n[t]||(n[t]=[]),n[t].push(e))}),a=a.map(e=>{let t=n[e.estate_title]||[];return{...e,images:t}}),console.log("succesfful fetch"),this.setState({loading:!1,estate_elements:a,estate_elements_empty:null,estate_main_text:{id:i.id,text:i.estate_main_text}})}else e.success&&null===e.estate_page?this.setState({loading:!1,estate_elements:[],estate_elements_empty:!0,estate_main_text:{id:null,text:""}}):this.setState({loading:!1,estate_elements:[],estate_elements_empty:null,estate_main_text:{id:null,text:""}})}).catch(e=>{console.log(e)})}}}),s("edyy0",function(t,s){e(t.exports,"Estates_view",()=>i);class i{constructor(){this.initial_elements_render=!1,this.estate_element_images=[],this.current_image_index={},this.slideshowIntervals={}}render_page_elements=e=>{let t=document.getElementById("estates-main-section1"),s=document.getElementById("estates-main-article1");if(e.loading){let e=document.createElement("div");e.setAttribute("id","estates-main-article1-p1-loading"),e.classList.add("loading"),s.appendChild(e);let i=document.createElement("div");i.setAttribute("id","estates-main-section1-loading"),i.classList.add("loading"),t.appendChild(i)}else{let i=document.getElementById("estates-main-article1-p1-loading"),a=document.getElementById("estates-main-section1-loading");if(i.remove(),a.remove(),Array.isArray(e.estate_elements)&&e.estate_elements.length>0&&e.estate_elements.every(e=>"string"==typeof e.estate_title&&Array.isArray(e.elements)&&Array.isArray(e.images))&&e.estate_main_text&&"object"==typeof e.estate_main_text&&"string"==typeof e.estate_main_text.id&&"string"==typeof e.estate_main_text.text&&!1===this.initial_elements_render){console.log(e.estate_main_text);let i=document.createElement("p");i.setAttribute("id",e.estate_main_text.id);let a=e.estate_main_text.text.split(/(?<=\.)\s+(?=[A-Z])/);i.textContent="",a.forEach((e,t)=>{let s=document.createTextNode(e);i.appendChild(s),t<a.length-1&&(i.appendChild(document.createElement("br")),i.appendChild(document.createElement("br")))}),s.appendChild(i),e.estate_elements.forEach(e=>{let s=document.createElement("article"),i=document.createElement("div"),a=document.createElement("div"),n=document.createElement("h3"),d=document.createElement("p"),l=document.createElement("div"),r=document.createElement("div"),o=document.createElement("div"),c=document.createElement("div"),m=document.createElement("a"),_=document.createElement("a"),u=document.createElement("p"),h=document.createElement("p"),g=document.createElement("div"),p=document.createElement("div"),v=document.createElement("div"),f=document.createElement("div");s.setAttribute("id",e.estate_title),s.classList.add("estates-main-section1-article1"),i.classList.add("estates-main-section1-article1-div1"),a.classList.add("estates-main-section1-article1-div2"),n.setAttribute("id",`${e.elements[0].estate_id}_title`),n.classList.add("estates-main-section1-article1-div-h3"),d.setAttribute("id",`${e.elements[0].estate_id}_desc`),d.classList.add("estates-main-section1-article1-div-p"),l.classList.add("estates-main-section1-article1-div-div1"),r.classList.add("estates-main-section1-article1-div-div1"),o.classList.add("estates-main-section1-article1-div-div1"),c.classList.add("estates-main-section1-article1-div2-div2-div1"),m.setAttribute("id",`${e.elements[0].estate_id}_google_maps`),m.setAttribute("href",e.elements[0].estate_google_maps_url),m.setAttribute("target","_blank"),m.classList.add("estates-main-section1-article1-div2-div2-a"),_.setAttribute("id",`${e.elements[0].estate_id}_google_street`),_.setAttribute("href",e.elements[0].estate_google_street_url),_.setAttribute("target","_blank"),_.classList.add("estates-main-section1-article1-div2-div2-a"),u.classList.add("estates-main-section1-article1-div2-div2-span1-p"),h.classList.add("estates-main-section1-article1-div2-div2-span1-p2"),h.setAttribute("id",`${e.elements[0].estate_id}_address`),g.classList.add("estates-main-section1-article1-div2-div1"),g.setAttribute("id",`${e.estate_title}_img_div`),p.classList.add("estates-main-section1-article1-div2-div1-img-backward"),p.setAttribute("id",`${e.estate_title}_div_backward`),v.classList.add("estates-main-section1-article1-div2-div1-img-forward"),v.setAttribute("id",`${e.estate_title}_div_forward`),f.classList.add("estates-main-section1-article1-div2-div1-img-footer"),f.setAttribute("id",`${e.estate_title}_div_footer`),n.textContent=e.elements[0].estate_title;let E=e.elements[0].estate_text.split(/(?<=\.)\s+(?=[A-Z])/);d.textContent="",E.forEach((e,t)=>{let s=document.createTextNode(e);d.appendChild(s),t<E.length-1&&(d.appendChild(document.createElement("br")),d.appendChild(document.createElement("br")))}),m.textContent="Google Maps Location",_.textContent="Google Street Location",u.textContent="Address:",h.textContent=e.elements[0].estate_address,p.textContent="<",v.textContent=">",t.appendChild(s),s.append(i,a),i.append(n,d,l,r),a.appendChild(g),l.appendChild(o),r.appendChild(c),o.append(m,_),c.append(u,h),a.appendChild(g),g.append(p,v,f);let y={},b=1;e.images.forEach(t=>{let s=document.createElement("img");s.classList.add("estates-main-section1-article1-div2-div1-img"),s.setAttribute("id",`${e.estate_title}_img_${b}`),s.setAttribute("src",t.estate_image_production_url),y[t.estate_category]||(y[t.estate_category]=[]),y[t.estate_category].push(s),console.log(b+=1)}),this.estate_element_images=[...this.estate_element_images,y],console.log(this.estate_element_images)}),this.initial_elements_render=!0,this.autochange_img_and_forward_and_backward_event_listener()}else{let e=document.getElementById("estates-main-article1"),t=document.getElementById("estates-main-section1"),s=document.createElement("p"),i=document.createElement("p");s.setAttribute("id","estates-main-article1-p1"),s.textContent="Currently no information about our estates, Please visit Later",i.setAttribute("id","estates-main-section1-p1"),i.textContent="Currently no information about our estates, Please visit Later",e.appendChild(s),t.appendChild(i),console.error("Invalid or missing data")}}};autochange_img_and_forward_and_backward_event_listener=()=>{this.slideshowIntervals=this.slideshowIntervals||{},this.current_image_index=this.current_image_index||{};let e=Array.from(document.getElementsByClassName("estates-main-section1-article1")),t=(e,t)=>{this.slideshowIntervals[e]&&clearInterval(this.slideshowIntervals[e]);let s=setInterval(t,1e4);this.slideshowIntervals[e]=s},s=(e,t)=>{let s=e.querySelector(".estates-main-section1-article1-div2-div1-img"),i=t.cloneNode(!0);if(i.classList.add("estates-main-section1-article1-div2-div1-img"),i.classList.remove("show"),s){let t=()=>{s.removeEventListener("transitionend",t),s.parentNode&&s.parentNode.removeChild(s),e.prepend(i),requestAnimationFrame(()=>i.classList.add("show"))};s.classList.remove("show"),s.addEventListener("transitionend",t),setTimeout(()=>{document.body.contains(s)&&(s.removeEventListener("transitionend",t),s.parentNode&&s.parentNode.removeChild(s),e.prepend(i),requestAnimationFrame(()=>i.classList.add("show")))},1100)}else e.prepend(i),requestAnimationFrame(()=>i.classList.add("show"))};e.forEach(e=>{this.estate_element_images.forEach(i=>{let a=Object.keys(i)[0];if(a===e.id){let n=i[a];if(!Array.isArray(n)||0===n.length)return;let d=document.getElementById(`${e.id}_img_div`);if(!d)return;this.current_image_index[a]=0;let l=n[0].cloneNode(!0);l.classList.add("estates-main-section1-article1-div2-div1-img","show"),d.prepend(l);let r=()=>{let e=n.length;if(e<=1)return;let t=(this.current_image_index[a]+1)%e;s(d,n[t]),this.current_image_index[a]=t};t(a,r)}});let i=document.getElementById(`${e.id}_div_backward`),a=document.getElementById(`${e.id}_div_forward`),n=(t,i)=>{let a=document.getElementById(`${e.id}_img_div`),n=a&&a.querySelector(".estates-main-section1-article1-div2-div1-img.show")||a&&a.children[0];if(!n)return;let d=this.estate_element_images.find(t=>Object.keys(t)[0]===e.id);if(!d)return;let l=Object.values(d)[0],r=l.length;if(!r)return;let o=l.findIndex(e=>e.id===n.id);if(-1===o&&(o=l.findIndex(e=>e.src===n.src)),-1===o)return;let c="back"===i?(o-1+r)%r:(o+1)%r;s(a,l[c]),this.current_image_index[e.id]=c,this.slideshowIntervals&&this.slideshowIntervals[e.id]&&(clearInterval(this.slideshowIntervals[e.id]),delete this.slideshowIntervals[e.id])};i&&i.addEventListener("click",e=>n(e,"back")),a&&a.addEventListener("click",e=>n(e,"forward"))})}}});
//# sourceMappingURL=controller.191285d4.js.map
