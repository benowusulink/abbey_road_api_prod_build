function e(e,t,s,n){Object.defineProperty(e,t,{get:s,set:n,enumerable:!0,configurable:!0})}var t=globalThis.parcelRequire8ea6,s=t.register;s("hwavo",function(s,n){e(s.exports,"Admin_news_and_events_controller",()=>_);var a=t("bPUw4"),i=t("j1YDN");class _{constructor(){this.view=new(0,i.Admin_news_and_events_view),this.model=new(0,a.Admin_news_and_events_model),this.model.fetch_news_or_events("news"),this.model.registerListener(e=>{this.view.render_fetch_news(e)}),this.view.ul_titles_news_li(this.ul_titles_news_li),this.view.ul_sort_by_recently_btn(this.ul_sort_by_recently_btn),this.view.news_or_events_form(this.news_or_events_form)}ul_sort_by_recently_btn=e=>{this.model.ul_sort_by_recently_btn(e)};ul_sort_by_alphabet_btn=e=>{this.model.ul_sort_by_alphabet_btn(e)};ul_titles_news_li=e=>{this.model.ul_titles_news_li(e)};ul_titles_events_li=e=>{this.model.ul_titles_events_li(e)};news_or_events_form=(e,t,s)=>{this.model.news_or_events_form(e,t,s)};add_news_article=e=>{this.model.add_news_article(e)};add_events_article=e=>{this.model.add_events_article(e)};delete_news_articles=e=>{this.model.delete_news_articles(e)};delete_events_articles=e=>{this.model.delete_events_article(e)}}}),s("bPUw4",function(t,s){e(t.exports,"Admin_news_and_events_model",()=>n);class n{constructor(){this.state={news:{loading:{loading_articles:!1,loading_selected_news_article:!1,loading_added_news_article:!1},view:{news_articles:null,selected_news_article:null,news_categories:null,added_news_article:!1,attempted_added_news_article:!1},add:{added_news_article:!1,attempted_added_news_article:!1},delete:{delete_news_article:!1,attempted_delete_news_article:!1}},events:{view:{events_articles:null,selected_events_article:null,events_categories:null,added_events_article:!1,attempted_added_events_article:!1},add:{added_events_article:!1,attempted_added_events_article:!1},delete:{delete_events_article:!1,attempted_delete_events_article:!1}}},this.listeners=[]}setState=e=>{let t=(e,s)=>{for(let n in s)"object"!=typeof e[n]||"object"!=typeof s[n]||null===e[n]||null===s[n]||Array.isArray(e[n])||Array.isArray(s[n])?e[n]=s[n]:t(e[n],s[n]);return e};return this.state=t({...this.state},e),this.notifyListeners(),console.log(this.state),this.state};registerListener=e=>{this.listeners.push(e),e(this.state)};notifyListeners=()=>{this.listeners.forEach(e=>{e(this.state)})};fetch_news_or_events=e=>{"news"===e?(this.setState({news:{loading:{loading_articles:!0}}}),fetch("http://localhost:3001/api/admin_news_and_events_page/fetch_news").then(e=>e.json()).then(e=>{e.success?(this.setState({news:{view:{news_articles:e.news_articles}}}),this.fetch_categories("news")):this.setState({news:{view:{news_articles:null}}})}).catch(e=>{console.log(e),this.setState({news:{view:{news_articles:null}}})})):"events"===e&&(this.setState({loading:!0}),fetch("https://www.abbeyroad.org.uk/api/admin_news_and_events_page/fetch_events").then(e=>e.json()).then(e=>{e.success?this.setState({events:{view:{events_articles:e.events_articles}}}):this.setState({events:{view:{events_articles:[]}}}),this.fetch_categories("events")}).catch(e=>{console.log(e),this.setState({events:{view:{events_articles:[]}}}),this.fetch_categories("events")}))};fetch_categories=e=>{if("news"===e){let e=["Updates","Community","Services"],t=[];this.state.news.view.news_articles.forEach(e=>{let s=e.news_category.trim(),n=s.charAt(0).toUpperCase()+s.slice(1).toLowerCase();t.includes(n)||t.push(n)}),t.forEach(t=>{e.includes(t)||e.push(t)}),this.setState({news:{loading:{loading_articles:!1},view:{news_categories:e}}})}else if("events"===e){let e=["Meetings","Fundrasing","Community Outings"],t=[];this.state.events.view.events_articles.forEach(e=>{let s=e.event_type.trim(),n=s.charAt(0).toUpperCase()+s.slice(1).toLowerCase();t.includes(n)||t.push(n)}),t.forEach(t=>{e.includes(t)||e.push(t)}),this.setState({loading:!1,events:{view:{events_categories:e}}})}};ul_sort_by_recently_btn=e=>{if("recently_added_news"===e&&this.state.news.view.news_articles){this.setState({loading:!0});let e=[...this.state.news.view.news_articles].sort((e,t)=>{let s=new Date,[n,a,i]=e.news_date.split("-").map(Number),[_,l,d]=t.news_date.split("-").map(Number),r=new Date(i,a-1,n);return Math.abs(r-s)-Math.abs(new Date(d,l-1,_)-s)});this.setState({loading:!1,news:{view:{news_articles:e}}})}else if("recently_added_events"===e&&this.state.events.view.events_articles){this.setState({loading:!0});let e=[...this.state.events.view.events_articles].sort((e,t)=>{let s=new Date,[n,a,i]=e.event_date.split("-").map(Number),[_,l,d]=t.event_date.split("-").map(Number),r=new Date(i,a-1,n),c=new Date(d,l-1,_),o=Math.abs(r-s);return Math.abs(c-s)-o});this.setState({loading:!1,events:{view:{events_articles:e}}})}};ul_sort_by_alphabet_btn=e=>{if("alphabetical_order_news"===e&&this.state.news.view.news_articles){this.setState({loading:!0});let e=[...this.state.news.view.news_articles].sort((e,t)=>{let s=e.news_headline.toLowerCase(),n=t.news_headline.toLowerCase();return s.localeCompare(n)});this.setState({loading:!1,news:{view:{news_articles:e}}})}else if("alphabetical_order_events"===e&&this.state.events.view.events_articles){let e=[...this.state.events.view.events_articles].sort((e,t)=>{let s=e.event_headline?.toLowerCase()||"",n=t.event_headline?.toLowerCase()||"";return s.localeCompare(n)});this.setState({loading:!1,events:{view:{events_articles:e}}})}};ul_titles_news_li=e=>{this.setState({news:{loading:{loading_selected_news_article:!0}}});let t=this.state.news.view.news_articles.filter(t=>{if(e===t.news_headline)return t});this.setState({news:{loading:{loading_selected_news_article:!1},view:{selected_news_article:t[0]}}})};ul_titles_events_li=e=>{this.setState({loading:!0});let t=this.state.events.view.events_articles.filter(t=>{if(e===t.events_headline)return t});this.setState({loading:!1,events:{view:{selected_events_article:t[0]}}})};news_or_events_form=(e,t,s)=>{if("news"===t)if(console.log("ey"),e.image&&s){this.setState({news:{loading:{loading_added_news_article:!0}}});let t=new FormData,n=this.state.news.view.selected_news_article.news_headline.trim().replace(/\s+/g,"_")+".jpg";e.news_date=(()=>{let e=new Date,t=String(e.getDate()).padStart(2,"0"),s=String(e.getMonth()+1).padStart(2,"0"),n=e.getFullYear();return`${t}-${s}-${n}`})(),t.append("news_image",e.image,n),delete e.image,t.append("news_form",JSON.stringify(e)),t.append("news_article",JSON.stringify(this.state.news.view.selected_news_article.news_headline)),t.append("old_image",JSON.stringify(s)),fetch("http://localhost:3001/api/admin_news_and_events_page/update_news_article",{method:"put",body:t}).then(e=>e.json()).then(e=>{e.success?this.setState({news:{loading:{loading_added_news_article:!1},view:{added_news_article:!0,selected_news_article:{...this.this.state.news.view.selected_news_article,...e.selected_news_article}}}}):this.setState({news:{loading:{loading_added_news_article:!1},view:{attempted_added_news_article:!0}}})}).catch(e=>{this.setState({news:{loading:{loading_added_news_article:!1},view:{attempted_added_news_article:!0}}})})}else 0===Object.keys(e).length?this.setState({news:{loading:{loading_added_news_article:!1},view:{attempted_added_news_article:!0}}}):e.image||s||(console.log(e),toJpgFilename(this.state.news.view.selected_news_article.news_headline),e.news_date=(()=>{let e=new Date,t=String(e.getDate()).padStart(2,"0"),s=String(e.getMonth()+1).padStart(2,"0"),n=e.getFullYear();return`${t}-${s}-${n}`})(),fetch("http://localhost:3001/api/admin_news_and_events_page/update_news_article",{method:"put",headers:{"Content-Type":"application/json"},body:JSON.stringify({news_form:e,news_article:this.state.news.view.selected_news_article.news_headline})}).then(e=>e.json()).then(e=>{e.success?this.setState({news:{loading:{loading_added_news_article:!1},view:{added_news_article:!0,selected_news_article:{...this.this.state.news.view.selected_news_article,...e.selected_news_article}}}}):this.setState({news:{loading:{loading_added_news_article:!1},view:{attempted_added_news_article:!0}}})}).catch(e=>{this.setState({news:{loading:{loading_added_news_article:!1},view:{attempted_added_news_article:!0}}})}));else"events"===t&&(Object.keys(e).length>0?(e.event_date=(e=>{if(!e)return"";let[t,s,n]=e.split("-");return`${n}-${s}-${t}`})(e.event_date),fetch("http://localhost:3001/api/admin_news_and_events_page/update_events_article",{method:"put",headers:{"Content-Type":"application/json"},body:JSON.stringify({events_form:e,events_article:this.state.events.view.selected_events_article.events_headline})}).then(e=>e.json()).then(e=>{e.success?this.setState({loading:!1,events:{view:{selected_events_article:{...this.this.state.events.view.selected_events_article,...e.selected_events_article}}}}):this.setState({events:{view:{attempted_added_events_article:!0}}})}).catch(e=>{this.setState({events:{view:{attempted_added_events_article:!0}}})})):0===Object.keys(e).length&&this.setState({events:{view:{attempted_added_events_article:!0}}}))};add_news_article=e=>{if(e.image){this.setState({loading:!0});let t=e.news_headline.trim().replace(/\s+/g,"_")+".jpg";e.news_date=(()=>{let e=new Date,t=String(e.getDate()).padStart(2,"0"),s=String(e.getMonth()+1).padStart(2,"0"),n=e.getFullYear();return`${t}-${s}-${n}`})();let s=new FormData;s.append("news_image",e.image,t),s.append("news_form",JSON.stringify(e)),fetch("http://localhost:3001/api/admin_news_and_events_page/add_news_article",{method:"post",body:s}).then(e=>e.json()).then(e=>{e.success?this.setState({loading:!1,news:{add:{added_news_article:!0,attempted_added_news_article:!1}}}):this.setState({loading:!1,news:{add:{added_news_article:!1,attempted_added_news_article:!0}}})}).catch(e=>{this.setState({loading:!1,news:{add:{added_news_article:!1,attempted_added_news_article:!0}}})})}else!e.image&&e?(this.setState({loading:!0}),e.news_date=(()=>{let e=new Date,t=String(e.getDate()).padStart(2,"0"),s=String(e.getMonth()+1).padStart(2,"0"),n=e.getFullYear();return`${t}-${s}-${n}`})(),fetch("http://localhost:3001/api/admin_news_and_events_page/add_news_article",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({news_form:e})}).then(e=>e.json()).then(e=>{e.success?this.setState({loading:!1,news:{add:{added_news_article:!0,attempted_added_news_article:!1}}}):this.setState({loading:!1,news:{add:{added_news_article:!1,attempted_added_news_article:!0}}})}).catch(e=>{this.setState({loading:!1,news:{add:{added_news_article:!1,attempted_added_news_article:!0}}})})):0===Object.keys(e).length&&this.setState({loading:!1,news:{add:{added_news_article:!1,attempted_added_news_article:!0}}})};add_events_article=e=>{Object.keys(e).length>0?(this.setState({loading:!0}),e.event_date=(e=>{if(!e)return"";let[t,s,n]=e.split("-");return`${n}-${s}-${t}`})(e.event_date),fetch("http://localhost:3001/api/admin_news_and_events_page/add_events_article",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({events_form:e})}).then(e=>e.json()).then(e=>{e.success?this.setState({loading:!1,events:{add:{added_events_article:!0,attempted_added_events_article:!1}}}):this.setState({loading:!1,events:{add:{added_events_article:!1,attempted_added_events_article:!0}}})}).catch(e=>{this.setState({loading:!1,events:{add:{added_events_article:!1,attempted_added_events_article:!0}}})})):0===Object.keys(e).length&&this.setState({loading:!1,events:{add:{added_events_article:!1,attempted_added_events_article:!0}}})};delete_news_article=e=>{if(e){this.setState({loading:!0});let t=e.trim().replace(/\s+/g,"_")+".jpg";fetch("http://localhost:3001/api/admin_news_and_events_page/delete_news_article",{method:"delete",headers:{"Content-Type":"application/json"},body:JSON.stringify({news_article_name:e,old_image_name:t})}).then(e=>e.json()).then(e=>{e.success?this.setState({loading:!1,news:{delete:{delete_news_article:!0,attempted_delete_news_article:!1}}}):this.setState({loading:!1,news:{delete:{delete_news_article:!1,attempted_delete_news_article:!0}}})}).catch(e=>{this.setState({loading:!1,news:{delete:{delete_news_article:!1,attempted_delete_news_article:!0}}})})}else this.setState({loading:!1,news:{delete:{delete_news_article:!1,attempted_delete_news_article:!0}}})};delete_events_article=e=>{e?(this.setState({loading:!0}),fetch("http://localhost:3001/api/admin_news_and_events_page/delete_events_article",{method:"delete",headers:{"Content-Type":"application/json"},body:JSON.stringify({events_article_name:e})}).then(e=>e.json()).then(e=>{e.success?this.setState({loading:!1,news:{delete:{delete_events_article:!0,attempted_delete_events_article:!1}}}):this.setState({loading:!1,events:{delete:{delete_events_article:!1,attempted_delete_events_article:!0}}})}).catch(e=>{this.setState({loading:!1,events:{delete:{delete_events_article:!1,attempted_delete_events_article:!0}}})})):this.setState({loading:!1,events:{delete:{delete_events_article:!1,attempted_delete_events_article:!0}}})}}}),s("j1YDN",function(t,s){e(t.exports,"Admin_news_and_events_view",()=>n);class n{constructor(){}articles_event_listener=e=>{let t=Array.from(document.getElementsByClassName("admin_news_and_events_page_main_section_article_div_span")),s=null;t.forEach((t,n)=>{t.addEventListener("click",()=>{s=`admin_news_and_events_page_main_section_article_div_span${n+1}`;let a=document.getElementById(`admin_news_and_events_page_main_section_section1_article_div${n+1}`);this.clicked_btn?(this.clicked_btn=!1,a.style.display="none",t.textContent="Click Here",t.style.fontSize="110%",t.style.color="var(--fourth-color)",t.style.backgroundColor="var(--third-color)",t.style.border="var(--fourth-color) solid 2px"):(this.clicked_btn=!0,a.style.display="flex",t.textContent="X",t.style.fontSize="200%",t.style.color="darkred",t.style.border="red solid 2px",e(n+1)),Array.from(document.getElementsByClassName("admin_news_and_events_page_main_section_article_div1")).forEach((e,t)=>{e.id!==a.id&&(e.style.display="none")}),Array.from(document.getElementsByClassName("admin_news_and_events_page_main_section_article_div_span")).forEach(e=>{s!==e.id&&(e.textContent="Click Here",e.style.fontSize="110%",e.style.color="var(--fourth-color)",e.style.backgroundColor="var(--third-color)",e.style.border="var(--fourth-color) solid 2px")})})})};render_fetch_news=e=>{let t=document.getElementById("admin_news_and_events_page_main_section_section1_article_div1_loading"),s=document.getElementById("admin_news_and_events_page_main_section_section1_article_div1_h4"),n=document.getElementById("admin_news_and_events_page_main_section_section1_article_div1_h41"),a=document.getElementById("admin_news_and_events_page_main_section_section1_article_div1_ul1"),i=document.getElementById("admin_news_and_events_page_main_section_section1_article_div1_ul2"),_=document.getElementById("admin_news_and_events_page_main_section_section1_article_div1_loading2"),l=document.getElementById("admin_news_and_events_page_main_section_section1_article_div1_h43"),d=document.getElementById("edit_news_form_div_loading"),r=document.getElementById("admin_news_and_events_page_main_section_section1_article_div1_div2"),c=document.getElementById("edit_news_form"),o=document.getElementById("edit_news_form_div"),w=()=>{t.style.display="none",s.style.display="none",n.style.display="none",a.style.display="none",_.style.display="none",l.style.display="none",d.style.display="none",r.style.display="none",c.style.display="none",i.style.display="none",o.style.display="none"},v=e=>{"loading1"===e?(w(),t.style.display="block"):"loading2"===e?_.style.display="block":"loading3"===e&&(o.style.display="flex",d.style.display="block")},h=t=>{if("first_render"===t)w(),n.style.display="flex",a.style.display="flex",i.style.display="flex",l.style.display="flex",i.replaceChildren(),e.news.view.news_articles.forEach(e=>{let t=document.createElement("li");t.classList.add("admin_news_and_events_page_main_section_section1_article_div1_ul2_li"),t.setAttribute("name",e.news_headline),t.textContent=e.news_headline,i.appendChild(t)});else if("second_render"===t){_.style.display="none",r.style.display="flex",c.style.display="flex";let t=document.getElementById("admin_news_and_events_page_main_section_section1_article_div1_div2_ul1_li_p1"),s=document.getElementById("admin_news_and_events_page_main_section_section1_article_div1_div2_ul1_li_p2"),n=document.getElementById("admin_news_and_events_page_main_section_section1_article_div1_div2_div1_p1"),a=document.getElementById("admin_news_and_events_page_main_section_section1_article_div1_div2_div2_p1"),i=document.getElementById("admin_news_and_events_page_main_section_section1_article_div1_div2_div3"),l=document.getElementById("admin_news_and_events_page_main_section_section1_article_div1_div2_div3_img");t.textContent=e.news.view.selected_news_article.news_headline,s.textContent=e.news.view.selected_news_article.news_date,n.textContent=e.news.view.selected_news_article.news_article,a.textContent=e.news.view.selected_news_article.news_category,e.news.view.selected_news_article.news_image_dev_src&&e.news.view.selected_news_article.news_image_prod_src?l.setAttribute("src",e.news.view.selected_news_article.news_image_prod_src):i.style.display="none";let d=document.getElementById("preset_edit_news_categories_select");d.replaceChildren(),e.news.view.news_categories.forEach((e,t)=>{let s=document.createElement("option");0===t?(s.setAttribute("value",""),s.setAttribute("disabled",""),s.setAttribute("selected",""),s.setAttribute("hidden",""),s.textContent="Select a category..."):(s.setAttribute("value",e),s.classList.add("preset_news_categories_options"),s.textContent=e),d.appendChild(s)})}else if("third_render"===t){d.style.display="none";let e=document.getElementById("edit_news_form_err_msg"),t=document.getElementById("edit_news_form_success_msg");e.style.display="none",t.style.display="flex"}else if("fourth_render"===t){d.style.display="none";let e=document.getElementById("edit_news_form_err_msg"),t=document.getElementById("edit_news_form_success_msg");e.style.display="flex",t.style.display="none"}};e.news.loading.loading_articles?v("loading1"):e.news.view.news_articles||e.news.view.news_categories?e.news.view.news_articles&&e.news.view.news_categories&&h("first_render"):(w(),s.style.display="flex"),e.news.loading.loading_selected_news_article?v("loading2"):!e.news.loading.loading_selected_news_article&&e.news.view.selected_news_article&&h("second_render"),e.news.loading.loading_added_news_article?v("loading3"):!e.news.loading.loading_added_news_article&&e.news.view.added_news_article?h("third_render"):!e.news.loading.loading_added_news_article&&e.news.view.attempted_added_news_article&&h("fourth_render")};ul_sort_by_recently_btn=(e,t)=>{"news"===e&&document.getElementById("admin_news_and_events_page_main_section_section1_article_div1_ul1").addEventListener("click",e=>{t(e.target.closest("li").getAttribute("name"))})};news_or_events_form=e=>{let t=document.getElementById("edit_news_form"),s=document.getElementById("admin_news_and_events_page_main_section_section1_article_div1_div2_div3_img");t.onsubmit=t=>{t.preventDefault();let n=document.getElementById("edit_news_form_title"),a=document.getElementById("preset_edit_news_categories_select"),i=document.getElementById("edit_news_form_category"),_=document.getElementById("edit_news_form_image"),l=document.getElementById("edit_news_form_article"),d={},r=null;s.getAttribute("src")&&(r=s.src.split("/").pop()),n.value.length>0&&(d.news_headline=n.value),a.value.length>0&&(d.news_category=a.value,i.value=""),i.value.length>0&&(d.news_category=i.value),_.files[0]&&(d.image=_.files[0]),l.value.length>0&&(d.news_article=l.value),e(d,"news",r)}};ul_titles_news_li=e=>{document.getElementById("admin_news_and_events_page_main_section_section1_article_div1_ul2").addEventListener("click",t=>{e(t.target.closest("li").getAttribute("name"))})}}});
//# sourceMappingURL=controller.7825e4e3.js.map
